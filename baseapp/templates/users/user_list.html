{% extends 'base.html' %}
{% block title %}Users list{% endblock %}
{% block content %}
    <div class="container mt-5">
        <h2 class="mb-4">Users list</h2>

        <!-- Search Form -->
        <div class="mb-4">
            <input type="text" id="searchInput" class="form-control" placeholder="Search by username, first name, last name, home or apartment">
        </div>

        <!-- User Table -->
        <table class="table table-striped" id="userTable">
            <thead>
                <tr>
                    <th>Username</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Email</th>
                    <th>Home</th>
                    <th>Apartment</th>
                </tr>
            </thead>
            <tbody id="userTableBody">
                <!-- Table rows will be populated by JavaScript -->
            </tbody>
        </table>
    </div>

    <script>
        document.getElementById('searchInput').addEventListener('input', function() {
            const query = this.value;
            fetch(`/users/search/?q=${encodeURIComponent(query)}`)
                .then(response => response.json())
                .then(data => {
                    const tbody = document.getElementById('userTableBody');
                    tbody.innerHTML = '';
                    if (data.users.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="4" class="text-center">No users found</td></tr>';
                    } else {
                        data.users.forEach(user => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${user.username}</td>
                                <td>${user.first_name}</td>
                                <td>${user.last_name}</td>
                                <td>${user.email}</td>
                                <td>${user.home}</td>
                                <td>${user.apartment}</td>
                            `;
                            tbody.appendChild(row);
                        });
                    }
                })
                .catch(error => console.error('Error:', error));
        });

        // Initial load
        document.getElementById('searchInput').dispatchEvent(new Event('input'));
    </script>
{% endblock %}